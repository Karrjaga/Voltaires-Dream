namespace = vn_flavor_ftm

#Nizarism
country_event = {
	id = vn_flavor_ftm.1
	title = "vn_flavor_ftm.1.t"
	desc = "vn_flavor_ftm.1.d"
	picture = RELIGIOUS_WARS_eventPicture

	fire_only_once = yes
	is_triggered_only = yes
	major = yes
	major_trigger = {
		religion_group = muslim
	}

	trigger = {
		normal_or_historical_nations = yes
		current_age = age_of_empire
		tag = FTM
		government = monarchy
		religion = shiite
		NOT = { started_in = 1094.1.10 }
		num_of_cities = 10
	}

	mean_time_to_happen = {
		days = 1
	}

	immediate = {
		hidden_effect = {
			set_country_flag = avoid_choosing_madhhab_flag
		}
	}

	after = {
		clr_country_flag = avoid_choosing_madhhab_flag
	}

	option = {
		name = "vn_flavor_ftm.1.a"
		ai_chance = { factor = 90 }
		if = {
			limit = { has_ruler_flag = nizar_heir_flag }
			tooltip = {
				kill_ruler = yes
			}
			define_ruler = {
				name = "al-Musta‘lî"
				dynasty = "Banû Fâtimah"
				adm = 1
				dip = 1
				mil = 0
			}
		}
		random_owned_province = {
			limit = {
				religion_group = muslim
				OR = {
					region = inner_egypt_region
					region = middle_egypt_region
					region = lower_egypt_region
				}
				is_capital = no
			}
			spawn_large_scaled_rebels = {
				type = qarmatian_rebels
				no_defined_leader = yes
			}
		}
		random_owned_province = {
			limit = {
				religion_group = muslim
				OR = {
					region = inner_egypt_region
					region = middle_egypt_region
					region = lower_egypt_region
				}
				is_capital = no
			}
			spawn_small_scaled_rebels = {
				type = qarmatian_rebels
				no_defined_leader = yes
			}
		}
		random_owned_province = {
			limit = {
				religion_group = muslim
				OR = {
					region = inner_egypt_region
					region = middle_egypt_region
					region = lower_egypt_region
				}
				is_capital = no
			}
			spawn_small_scaled_rebels = {
				type = qarmatian_rebels
				no_defined_leader = yes
			}
		}
	}
	option = {
		name = "vn_flavor_ftm.1.b"
		ai_chance = { factor = 10 }
		change_religion = qarmatian
		hidden_effect = {
			set_religious_school = {
				group = muslim
				school = nizari_school
			}
		}
		if = {
			limit = { NOT = { has_ruler_flag = nizar_heir_flag } }
			tooltip = {
				kill_ruler = yes
			}
			define_ruler = {
				name = "Nizâr"
				dynasty = "Banû Fâtimah"
				adm = 2
				dip = 6
				mil = 1
			}
		}
		hidden_effect = {
			add_ruler_personality = zealot_personality
		}
		random_owned_province = {
			limit = {
				religion_group = muslim
				OR = {
					region = inner_egypt_region
					region = middle_egypt_region
					region = lower_egypt_region
				}
				is_capital = no
			}
			spawn_large_scaled_rebels = {
				type = shiite_rebels
				no_defined_leader = yes
			}
		}
		random_owned_province = {
			limit = {
				religion_group = muslim
				OR = {
					region = inner_egypt_region
					region = middle_egypt_region
					region = lower_egypt_region
				}
				is_capital = no
			}
			spawn_small_scaled_rebels = {
				type = shiite_rebels
				no_defined_leader = yes
			}
		}
		random_owned_province = {
			limit = {
				religion_group = muslim
				OR = {
					region = inner_egypt_region
					region = middle_egypt_region
					region = lower_egypt_region
				}
				is_capital = no
			}
			spawn_small_scaled_rebels = {
				type = shiite_rebels
				no_defined_leader = yes
			}
		}
	}
}

#Ayyubid Coup
country_event = {
	id = vn_flavor_ftm.2
	title = "vn_flavor_ftm.2.t"
	desc = "vn_flavor_ftm.2.d"
	picture = ASSASSINATION_eventPicture

	major = yes
	fire_only_once = yes
	is_triggered_only = yes

	# trigger = {
	# 	tag = FTM
	# 	NOT = { exists = MAM }
	# 	current_age = age_of_holy_wars
	# 	normal_or_historical_nations = yes
	# 	is_free_or_tributary_trigger = yes
	# 	any_owned_province = { religion = sunni }
	# 	NOT = { started_in = 1171.9.13 }
	# 	NOT = { owns = 4974 }
	# 	NOT = { ADM = 3 }
	# 	NOT = { DIP = 3 }
	# 	NOT = { MIL = 3 }
	# 	religion = shiite
	# }

	# mean_time_to_happen =  {
	# 	months = 120
	# 	modifier = {
	# 		factor = 2
	# 		war_score = 50
	# 	}
	# 	modifier = {
	# 		factor = 2
	# 		at_war_with_religious_enemy = yes
	# 	}
	# 	modifier = {
	# 		factor = 0.5
	# 		has_regency = yes
	# 	}
	# 	modifier = {
	# 		factor = 0.5
	# 		war_exhaustion = 10
	# 	}
	# }

	immediate = {
		hidden_effect = {
			set_country_flag = avoid_choosing_madhhab_flag
		}
	}
	
	option = {
		name = "vn_flavor_ftm.2.a"
		ai_chance = { factor = 95 }
		custom_tooltip = vn_flavor_ftm.2.tt
		change_religion = sunni
		set_religious_school = {
			group = muslim
			school = shafii_school
		}
		define_ruler = {
			name = "Yûsuf"
			dynasty = "Eyûbî"
			age = 33
			culture = sorani
			adm = 6
			dip = 6
			mil = 6
		}
		hidden_effect = {
			change_tag = MAM
			set_government_rank = 5
			change_government = monarchy
			if = {
				limit = { has_dlc = "Winds of Change" }
				add_government_reform = ayyubid_dynasty
			}
			else = {
				add_government_reform = iqta
			}
			remove_heir = {}
			swap_free_idea_group = yes
			define_ruler_to_general = {
				fire = 6
				shock = 5
				manuever = 2
				siege = 5
			}
			add_ruler_personality = inspiring_leader_personality
			add_ruler_personality = lawgiver_personality
			add_ruler_personality = legendary_conqueror_personality
			override_country_name = AYYUBIDS_NAME
			set_country_flag = ayyubids_name_flag
		}
		clr_country_flag = avoid_choosing_madhhab_flag
	}
	# option = {
	# 	name = "vn_flavor_ftm.2.b"
	# 	ai_chance = { factor = 5 }
	# 	random_owned_province = {
	# 		spawn_rebels = {
	# 			type = pretender_rebels
	# 			leader = "Yûsuf"
	# 			leader_dynasty = "Eyûbî"
	# 			size = 5
	# 			unrest = 15
	# 			win = yes
	# 			religion = sunni
	# 			culture = kurdish
	# 		}
	# 	}
	# 	clr_country_flag = avoid_choosing_madhhab_flag
	# }
}

# #Annual Nile Floodings - Good
# country_event = {
#     id = vn_flavor_ftm.3
#     title = vn_flavor_ftm.3.t
#     desc = vn_flavor_ftm.3.d
#     picture = 19_Monsoon_eventPicture
# 	goto = egyptian_flood_prov
    
#     trigger = {
# 		any_owned_province = {
# 			OR = {
# 				region = lower_egypt_region
# 				region = inner_egypt_region
# 				region = middle_egypt_region
# 			}
# 			OR = {
# 				has_monsoon = severe_monsoon
# 				has_monsoon = normal_monsoon
# 				has_monsoon = mild_monsoon
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = failed_monsoon
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = good_monsoon_modifier
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = plum_rains
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = nile_floodings_good_mod
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = nile_floodings_bad_mod
# 			}
# 		}
#     }

#     immediate = {
# 		hidden_effect = {
# 			random_owned_province = {
# 				limit = {
# 					OR = {
# 						region = lower_egypt_region
# 						region = inner_egypt_region
# 						region = middle_egypt_region
# 					}
# 					OR = {
# 						has_monsoon = severe_monsoon
# 						has_monsoon = normal_monsoon
# 						has_monsoon = mild_monsoon
# 					}
# 				}
# 				save_event_target_as = egyptian_flood_prov
# 			}
# 		}
# 	}
	
# 	mean_time_to_happen = {
# 		months = 180
# 	}

#     option = {      
#         name = EXCELLENT
# 		add_years_of_income = 0.75
# 		custom_tooltip = vn_flavor_ftm.3.tt
# 		tooltip = {
# 			add_prosperity = 25
# 			add_province_modifier = {
# 				name = nile_floodings_good_mod
# 				duration = 1825
# 			}
# 		}
# 		hidden_effect = {
# 			event_target:plum_rains_province = {
# 				region = {
# 					limit = {
# 						owned_by = ROOT
# 						OR = {
# 							has_monsoon = severe_monsoon
# 							has_monsoon = normal_monsoon
# 							has_monsoon = mild_monsoon
# 						}
# 					}
# 					add_prosperity = 25
# 					add_province_modifier = {
# 						name = nile_floodings_good_mod
# 						duration = 1825
# 					}
# 				}
# 			}
# 		}
#     }
# }

# #Annual Nile Floodings - Bad
# country_event = {
#     id = vn_flavor_ftm.4
#     title = vn_flavor_ftm.4.t
#     desc = vn_flavor_ftm.4.d
#     picture = 20_Monsoon_eventPicture
# 	goto = egyptian_flood_prov
    
#     trigger = {
# 		any_owned_province = {
# 			OR = {
# 				region = lower_egypt_region
# 				region = inner_egypt_region
# 				region = middle_egypt_region
# 			}
# 			OR = {
# 				has_monsoon = severe_monsoon
# 				has_monsoon = normal_monsoon
# 				has_monsoon = mild_monsoon
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = failed_monsoon
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = good_monsoon_modifier
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = plum_rains
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = nile_floodings_good_mod
# 			}
# 		}
# 		NOT = {
# 			any_owned_province = {
# 				has_province_modifier = nile_floodings_bad_mod
# 			}
# 		}
#     }

#     immediate = {
# 		hidden_effect = {
# 			random_owned_province = {
# 				limit = {
# 					OR = {
# 						region = lower_egypt_region
# 						region = inner_egypt_region
# 						region = middle_egypt_region
# 					}
# 					OR = {
# 						has_monsoon = severe_monsoon
# 						has_monsoon = normal_monsoon
# 						has_monsoon = mild_monsoon
# 					}
# 				}
# 				save_event_target_as = egyptian_flood_prov
# 			}
# 		}
# 	}
	
# 	mean_time_to_happen = {
# 		months = 180
# 	}

#     option = {      
#         name = monsoon_events.2.a
# 		add_years_of_income = -0.75
# 		custom_tooltip = vn_flavor_ftm.3.tt
# 		tooltip = {
# 			add_devastation = 20
# 			add_province_modifier = {
# 				name = nile_floodings_bad_mod
# 				duration = 1825
# 			}
# 		}
# 		hidden_effect = {
# 			event_target:plum_rains_province = {
# 				region = {
# 					limit = {
# 						owned_by = ROOT
# 						OR = {
# 							has_monsoon = severe_monsoon
# 							has_monsoon = normal_monsoon
# 							has_monsoon = mild_monsoon
# 						}
# 					}
# 					add_devastation = 20
# 					add_province_modifier = {
# 						name = nile_floodings_bad_mod
# 						duration = 1825
# 					}
# 				}
# 			}
# 		}
#     }
# }