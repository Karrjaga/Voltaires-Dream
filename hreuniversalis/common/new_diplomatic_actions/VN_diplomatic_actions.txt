#Seigneury
turn_seigneury_into_vassal = {
	category = influence

	alert_index = 90
	alert_tooltip = turn_seigneury_into_vassal_alert_tooltip

	require_acceptance = yes

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = seigneury
		}
	}

	is_allowed = {
		if = {
			limit = {
				FROM = {
					NOT = { religion = catholic }
					NOT = { religion = catholique }
				}
			}
			custom_trigger_tooltip = {
				tooltip = sell_indulgence_catholic
				FROM = {
					OR = {
						religion = catholic
						religion = catholique
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = {
						years_in_vassalage_under = {
							who = ROOT
							years = 50
							all_subject_country = yes
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = CONVERT_SEIGNEURY_AFTER_50_YEARS
				FROM = {
					years_in_vassalage_under = {
						who = ROOT
						years = 50
						all_subject_country = yes
					}
				}
			}
		}
	}

	on_accept = {
		create_subject = {
			subject_type = vassal
			subject = FROM
			keep_liberty_desire = yes
		}
		every_subject_country = {
			limit = { is_subject_of_type = seigneury }
			add_opinion = {
				who = ROOT
				modifier = converted_seigneury_into_vassal_opinion
			}
		}
	}

	on_decline = { }

	ai_acceptance = {
		add_entry = {
			name = BASE_REJECTION
			limit = {
				always = yes
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -25
			}
		}
		add_entry = {
			name = AI_LIBERTY_DESIRE
			limit = {
				FROM = {
					liberty_desire = 50
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = DIPLO_HAS_AI_HAS_OWN_SUBJECTS_TT
			limit = {
				FROM = { num_of_subjects = 1 }
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = LOWER_MIL_TECH
			limit = {
				ROOT = {
					NOT = { mil_tech = FROM }
				}
			}
			export_to_variable = {
				which = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -10
			}
		}
	}

	ai_will_do = {
		prestige = 1
		FROM = {
			has_opinion = {
				who = ROOT
				value = 50
			}
		}
	}
}

cancel_seigneury = {
	category = influence
	require_acceptance = no

	is_visible = {
		OR = {
			AND = {
				is_subject_of = FROM
				is_subject_of_type = seigneury
			}
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = seigneury
			}
		}
	}

	is_allowed = {
		NOT = { truce_with = FROM }
	}

	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = seigneury
			}
			grant_independence = yes		
		}
		else = {
			FROM = {
				grant_independence = yes
			}
		}
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = seigneury
				NOT = { liberty_desire = 100 }
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_stability = -1
			}
			add_country_modifier = {
				name = cancel_seigneury_timer
				duration = 3650
				hidden = yes
			}
		}
		else_if = {
			limit = {
				FROM = {
					NOT = { liberty_desire = 100 }
				}
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_stability = -1
			}
			FROM = {
				add_country_modifier = {
					name = cancel_seigneury_timer
					duration = 3650
					hidden = yes
				}
			}
		}
	}

	on_decline = {
	}

	ai_will_do = {
		is_subject_of = FROM
		OR = {
			liberty_desire = 100
			AND = {
				stability = 1
				liberty_desire = 90
				NOT = {
					has_opinion = {
						who = ROOT
						value = -50
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 80
				NOT = {
					has_opinion = {
						who = ROOT
						value = -100
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 70
				NOT = {
					has_opinion = {
						who = ROOT
						value = -150
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 60
				NOT = {
					has_opinion = {
						who = ROOT
						value = -199
					}
				}
			}
		}
		NOT = {
			any_neighbor_country = {
				ROOT = {
					ai_attitude = {
						who = PREV
						attitude = attitude_threatened
					}
				}
			}
		}
	}
}

call_seigneury_into_wars = {
	category = influence
	require_acceptance = no

	is_visible = {
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = seigneury
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
		if = {
			limit = {
				is_at_war = no
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_NOT_AT_WAR_TT
				is_at_war = yes
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = {
						has_opinion = {
							who = ROOT
							value = 0
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_MUST_HAVE_POSITIVE_OPINION_TT
				FROM = {
					has_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
	}
	on_accept = {
		FROM = {
			add_opinion = {
				who = ROOT
				modifier = trade_protectorate_called_into_war
			}
			join_all_defensive_wars_of = ROOT
		}
		if = {
			limit = {
				is_in_war = { attackers = ROOT }
			}
			FROM = {
				add_opinion = {
					who = ROOT
					modifier = trade_protectorate_called_into_war
				}
				join_all_offensive_wars_of = ROOT
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		always = yes
	}
}

offer_seigneury = {
	category = influence
	require_acceptance = yes

	alert_index = 4
	alert_tooltip = offer_seigneury_alert_tooltip

	is_visible = {
		OR = {
			has_reform = frankokratia_reform
			has_reform = holy_state_reform
		}
		OR = {
			AND = {
				is_greek_crusader_state = yes
				FROM = { is_greek_crusader_state = yes }
			}
			AND = {
				is_levantine_crusader_state = yes
				FROM = { is_levantine_crusader_state = yes }
			}
		}
		NOT = {
			FROM = {
				is_subject_of_type = seigneury
			}
		}
	}
	is_allowed = {
		if = {
			limit = {
				FROM = {
					NOT = { religion = catholic }
					NOT = { religion = catholique }
				}
			}
			custom_trigger_tooltip = {
				tooltip = sell_indulgence_catholic
				FROM = {
					OR = {
						religion = catholic
						religion = catholique
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = {
				FROM = { is_subject = yes }
			}
			custom_trigger_tooltip = {
				tooltip = CANNOT_DO_ACTION_TO_SUBJECTS_TT
				FROM = { is_subject = no }
			}
		}
		if = {
			limit = {
				FROM = {
					NOT = {
						has_opinion = {
							who = ROOT
							value = 0
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_MUST_HAVE_POSITIVE_OPINION_TT
				FROM = {
					has_opinion = {
						who = ROOT
						value = 0
					}
				}
			}
		}
		if = {
			limit = {
				FROM = {
					OR = {
						has_reform = steppe_horde
						has_reform = great_mongol_state_reform
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_A_HORDE_TT
				FROM = {
					NOT = { has_reform = steppe_horde }
					NOT = { has_reform = great_mongol_state_reform }
				}
			}
		}
		if = {
			limit = {
				FROM = {
					is_part_of_hre = yes
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_PART_OF_HRE_TT
				FROM = {
					NOT = { is_part_of_hre = yes }
				}
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = seigneury
			subject = FROM
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
			FROM = {
				any_neighbor_country = {
					NOT = { tag = ROOT }
					FROM = {
						ai_attitude = {
							who = PREV
							attitude = attitude_threatened
						}
					}
				}
			}
			FROM = {
				ai_attitude = {
					who = ROOT
					attitude = attitude_threatened
				}
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		has_opinion = {
			who = FROM
			value = 50
		}
		NOT = {
			FROM = {
				has_country_modifier = cancel_seigneury_timer
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = BASE_REJECTION
			limit = {
				always = yes
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -25
			}
		}
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = DIPLO_HAS_AI_HAS_OWN_SUBJECTS_TT
			limit = {
				FROM = { num_of_subjects = 1 }
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#2 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.2
			}
		}
	}
}

#Partial Principality
offer_partial_principality = {
	category = influence
	require_acceptance = yes

	alert_index = 91
	alert_tooltip = offer_partial_principality_alert_tooltip

	is_visible = {
		#OR = {
			has_reform = celestial_empire
			#has_government_attribute = can_establish_partial_principalities
		#}
		is_subject = no
		FROM = { is_subject = no }
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					FROM = {
						capital_scope = {
							OR = {
								superregion = russia_superregion
								superregion = ruthenia_superregion
							}
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_REQUIRES_CAPITAL_IN_RUSSIA_TT
				FROM = {
					capital_scope = {
						OR = {
							superregion = russia_superregion
							superregion = ruthenia_superregion
						}
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = {
				FROM = {
					has_not_locked_first_tier_reform = no
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_WRONG_GOVERNMENT_REFORM_TT
				FROM = {
					has_not_locked_first_tier_reform = yes
				}
			}
		}
		if = {
			limit = {
				FROM = {
					is_part_of_hre = yes
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_PART_OF_HRE_TT
				FROM = {
					NOT = { is_part_of_hre = yes }
				}
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = partial_principality
			subject = FROM
		}
		FROM = {
			if = {
				limit = {
					NOT = { government = republic }
				}
				change_government = monarchy
				add_government_reform = principality
			}
			else_if = {
				limit = {
					government = republic
				}
				change_government = republic
				add_government_reform = veche_republic
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
			FROM = {
				any_neighbor_country = {
					NOT = { tag = ROOT }
					FROM = {
						ai_attitude = {
							who = PREV
							attitude = attitude_threatened
						}
					}
				}
			}
			FROM = {
				ai_attitude = {
					who = ROOT
					attitude = attitude_threatened
				}
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		has_opinion = {
			who = FROM
			value = 50
		}
		NOT = {
			FROM = {
				has_country_modifier = cancel_partial_principality_timer
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = BASE_REJECTION
			limit = {
				always = yes
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -25
			}
		}
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = DIPLO_HAS_AI_HAS_OWN_SUBJECTS_TT
			limit = {
				FROM = { num_of_subjects = 1 }
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#2 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.2
			}
		}
	}
}

cancel_partial_principality = {
	category = influence
	require_acceptance = no

	is_visible = {
		OR = {
			AND = {
				is_subject_of = FROM
				is_subject_of_type = partial_principality
			}
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = partial_principality
			}
		}
	}
	is_allowed = {
	}
	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = partial_principality
			}
			grant_independence = yes		
		}
		else = {
			FROM = {
				grant_independence = yes
			}
		}
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = partial_principality
				NOT = { liberty_desire = 100 }
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_stability = -1
			}
			add_country_modifier = {
				name = cancel_partial_principality_timer
				duration = 3650
				hidden = yes
			}
		}
		else_if = {
			limit = {
				FROM = {
					NOT = { liberty_desire = 100 }
				}
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_stability = -1
			}
			FROM = {
				add_country_modifier = {
					name = cancel_partial_principality_timer
					duration = 3650
					hidden = yes
				}
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # Overlords will never want to break the relationship
		is_subject_of = FROM
		OR = {
			liberty_desire = 100
			AND = {
				stability = 1
				liberty_desire = 90
				NOT = {
					has_opinion = {
						who = ROOT
						value = -50
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 80
				NOT = {
					has_opinion = {
						who = ROOT
						value = -100
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 70
				NOT = {
					has_opinion = {
						who = ROOT
						value = -150
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 60
				NOT = {
					has_opinion = {
						who = ROOT
						value = -199
					}
				}
			}
		}
		NOT = {
			any_neighbor_country = {
				ROOT = {
					ai_attitude = {
						who = PREV
						attitude = attitude_threatened
					}
				}
			}
		}
	}
}

request_partial_principality = {
	category = influence
	require_acceptance = yes

	alert_index = 92
	alert_tooltip = request_partial_principality_alert_tooltip

	is_visible = {
		FROM = {
			#OR = {
				has_reform = celestial_empire
				#has_government_attribute = can_establish_partial_principalities
			#}
		}
		is_subject = no
		FROM = { is_subject = no }
		NOT = { has_reform = steppe_horde }
		NOT = { has_reform = great_mongol_state_reform }
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					capital_scope = {
						OR = {
							superregion = russia_superregion
							superregion = ruthenia_superregion
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_REQUIRES_CAPITAL_IN_RUSSIA_TT
				capital_scope = {
					OR = {
						superregion = russia_superregion
						superregion = ruthenia_superregion
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = {
				is_part_of_hre = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_PART_OF_HRE_TT
				NOT = { is_part_of_hre = yes }
			}
		}
	}
	on_accept = {
		FROM = {
			create_subject = {
				subject_type = partial_principality
				subject = ROOT
			}
		}
		if = {
			limit = {
				government = monarchy
			}
			add_government_reform = principality
		}
		else_if = {
			limit = {
				government = monarchy
			}
			add_government_reform = veche_republic
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_threatened
			}
			any_neighbor_country = {
				NOT = { tag = FROM }
				ROOT = {
					ai_attitude = {
						who = PREV
						attitude = attitude_threatened
					}
				}
			}
			FROM = {
				OR = {
					ai_attitude = {
						who = ROOT
						attitude = attitude_domineering
					}
					ai_attitude = {
						who = ROOT
						attitude = attitude_protective
					}
				}
			}
		}
		NOT = { mil_tech = FROM }
		OR = {
			NOT = { army_size = FROM }
			AND = {
				capital_scope = { is_island = yes }
				NOT = { navy_size = FROM }
			}
			FROM = {
				military_strength = {
					who = ROOT
					value = 2
				}
			}
		}
		NOT = { has_country_modifier = cancel_partial_principality_timer }
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_rivalry
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = DIPLO_OUR_TOTAL_DEVELOPMENT_TT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = ROOT
			}
			#10 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.1
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 50 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 1000 }
		}
		add_entry = {
			name = attitude_protective_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_protective } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#2 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.2
			}
		}
	}
}

turn_partial_principality_into_vassal = {
	category = influence

	alert_index = 93
	alert_tooltip = turn_partial_principality_into_vassal_tooltip

	require_acceptance = yes

	is_visible = {
		has_dlc = "Mandate of Heaven"
		is_emperor_of_china = yes
		FROM = {
			is_subject_of = ROOT
			is_subject_of_type = partial_principality
		}
	}
	is_allowed = {
		if = {
			limit = {
				NOT = { imperial_mandate = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_POSITIVE_MANDATE_TT
				imperial_mandate = 50
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 5 }
				FROM = {
					NOT = { total_development = 50 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_5_MANDATE_TT
				imperial_mandate = 5
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 10 }
				FROM = {
					total_development = 50
					NOT = { total_development = 100 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_10_MANDATE_TT
				imperial_mandate = 10
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 20 }
				FROM = {
					total_development = 100
					NOT = { total_development = 150 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_20_MANDATE_TT
				imperial_mandate = 20
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 30 }
				FROM = {
					total_development = 150
					NOT = { total_development = 200 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_30_MANDATE_TT
				imperial_mandate = 30
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 40 }
				FROM = {
					total_development = 200
					NOT = { total_development = 250 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_40_MANDATE_TT
				imperial_mandate = 40
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 50 }
				FROM = {
					total_development = 250
					NOT = { total_development = 300 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_50_MANDATE_TT
				imperial_mandate = 50
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 60 }
				FROM = {
					total_development = 300
					NOT = { total_development = 350 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_60_MANDATE_TT
				imperial_mandate = 60
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 70 }
				FROM = {
					total_development = 350
					NOT = { total_development = 400 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_70_MANDATE_TT
				imperial_mandate = 70
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 80 }
				FROM = {
					total_development = 400
					NOT = { total_development = 450 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_80_MANDATE_TT
				imperial_mandate = 80
			}
		}
		if = {
			limit = {
				NOT = { imperial_mandate = 90 }
				FROM = {
					total_development = 450
					NOT = { total_development = 500 }
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NEEDS_90_MANDATE_TT
				imperial_mandate = 90
			}
		}
		if = {
			limit = {
				FROM = { total_development = 500 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_LESS_THAN_500_DEV_TT
				FROM = { NOT = { total_development = 500 } }
			}
		}
		if = {
			limit = {
				FROM = { total_development = ROOT }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_LESS_THAN_ROOT_DEV_TT
				FROM = { NOT = { total_development = ROOT } }
			}
		}
		if = {
			limit = {
				FROM = { liberty_desire = 50 }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_REBELLIOUS_TT
				FROM = { liberty_desire = 50 }
			}
		}
		if = {
			limit = {
				NOT = { has_global_flag = grand_prince_vassalize_partial_principalities }
			}
			custom_trigger_tooltip = {
				tooltip = NEED_RUSSIAN_REFORM_TO_VASSALIZE_TT
				has_global_flag = grand_prince_vassalize_partial_principalities
			}
		}
	}
	on_accept = {
		if = {
			limit = {
				FROM = {
					total_development = 450
				}
			}
			add_mandate = -90
		}
		else_if = {
			limit = {
				FROM = {
					total_development = 400
				}
			}
			add_mandate = -80
		}
		else_if = {
			limit = {
				FROM = {
					total_development = 350
				}
			}
			add_mandate = -70
		}
		else_if = {
			limit = {
				FROM = {
					total_development = 300
				}
			}
			add_mandate = -60
		}
		else_if = {
			limit = {
				FROM = {
					total_development = 250
				}
			}
			add_mandate = -50
		}
		else_if = {
			limit = {
				FROM = {
					total_development = 200
				}
			}
			add_mandate = -40
		}
		else_if = {
			limit = {
				FROM = {
					total_development = 150
				}
			}
			add_mandate = -30
		}
		else_if = {
			limit = {
				FROM = {
					total_development = 100
				}
			}
			add_mandate = -20
		}
		else_if = {
			limit = {
				FROM = {
					total_development = 50
				}
			}
			add_mandate = -10
		}
		else = {
			add_mandate = -5
		}
		create_subject = {
			subject_type = vassal
			subject = FROM
			keep_liberty_desire = yes
		}
		every_subject_country = {
			limit = { is_subject_of_type = partial_principality }
			add_opinion = {
				who = ROOT
				modifier = converted_partial_principality_into_vassal_opinion
			}
		}
	}
	on_decline = {
	}
	ai_will_do = {
		imperial_mandate = 95
		FROM = {
			has_opinion = {
				who = ROOT
				value = 50
			}
		}
	}

	ai_acceptance = {
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.2
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 4
			multiply_variable = {
				which = ai_value
				value = 4
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = AI_LIBERTY_DESIRE
			export_to_variable = {
				variable_name = ai_value
				value = liberty_desire
				who = FROM
			}
			multiply_variable = {
				which = ai_value
				value = -1
			}
		}
	}
}

#Appanage
# demand_independence_as_appanage = {
# 	category = influence
# 	require_acceptance = yes

# 	alert_index = 94
# 	alert_tooltip = demand_independence_as_appanage_tooltip

# 	is_visible = {
# 		is_subject_of = FROM
# 		is_subject_of_type = appanage
# 	}
# 	is_allowed = { }
# 	on_accept = {
# 		if = {
# 			limit = {
# 				is_subject_of = FROM
# 				is_subject_of_type = appanage
# 			}
# 			grant_independence = yes
# 			reverse_add_casus_belli = {
# 				type = cb_disloyal_vassal
# 				target = FROM
# 			}	
# 		}
# 	}
# 	on_decline = {
# 		if = {
# 			limit = {
# 				is_subject_of = FROM
# 				is_subject_of_type = appanage
# 			}
# 			declare_war_with_cb = {
# 				casus_belli = cb_independence_war
# 				who = FROM
# 			}
# 		}
# 	}

# 	ai_will_do = {
# 		is_subject_of = FROM
# 		OR = {
# 			liberty_desire = 100
# 			AND = {
# 				stability = 1
# 				liberty_desire = 90
# 				NOT = {
# 					has_opinion = {
# 						who = ROOT
# 						value = -50
# 					}
# 				}
# 			}
# 			AND = {
# 				stability = 1
# 				liberty_desire = 80
# 				NOT = {
# 					has_opinion = {
# 						who = ROOT
# 						value = -100
# 					}
# 				}
# 			}
# 			AND = {
# 				stability = 1
# 				liberty_desire = 70
# 				NOT = {
# 					has_opinion = {
# 						who = ROOT
# 						value = -150
# 					}
# 				}
# 			}
# 			AND = {
# 				stability = 1
# 				liberty_desire = 60
# 				NOT = {
# 					has_opinion = {
# 						who = ROOT
# 						value = -199
# 					}
# 				}
# 			}
# 		}
# 		NOT = {
# 			any_neighbor_country = {
# 				ROOT = {
# 					ai_attitude = {
# 						who = PREV
# 						attitude = attitude_threatened
# 					}
# 				}
# 			}
# 		}
# 	}

# 	ai_acceptance = {
#         add_entry = {
#             name = DIPLO_OPPINION
# 			export_to_variable = {
# 				variable_name = ai_value
# 				value = opinion
# 				who = FROM
# 				with = ROOT
# 			}
# 			multiply_variable = {
# 				which = ai_value 
# 				value = 0.125
# 			}
#         }
# 		add_entry = {
# 			name = AI_TRUST_TOWARDS_ROOT
# 			export_to_variable = {
# 				variable_name = ai_value
# 				value = trust
# 				who = FROM
# 				with = ROOT
# 			}			
# 			subtract_variable = { 
# 				which = ai_value
# 				value = 50
# 			}
# 			#1 trust = +4 ai points
# 			multiply_variable = {
# 				which = ai_value
# 				value = 0.4
# 			}
# 		}
# 		add_entry = {
# 			name = AI_DIPLOMATIC_REPUTATION
# 			export_to_variable = {
# 				variable_name = ai_value
# 				value = trigger_value:diplomatic_reputation
# 			}
# 			#1 rep = 3
# 			multiply_variable = {
# 				which = ai_value
# 				value = 3
# 			}
# 		}
# 	}
# }

#Hashashins
# assassinate_foreign_ruler = {
# 	category = covert
# 	require_acceptance = no

# 	is_visible = {
# 		tag = HAH
# 	}
# 	is_allowed = {
# 		if = {
# 			limit = {
# 				FROM = { liberty_desire = 50 }
# 			}
# 			custom_trigger_tooltip = {
# 				tooltip = FROM_IS_NOT_A_MONARCHY_TT
# 				FROM = {
# 					NOT = { government = monarchy }
# 					NOT = { government = tribal }
# 				}
# 			}
# 		}
# 		if = {
# 			limit = {
# 				FROM = { has_regency = yes }
# 			}
# 			custom_trigger_tooltip = {
# 				tooltip = FROM_HAS_A_REGENCY_TT
# 				has_regency = yes
# 			}
# 		}
# 		if = {
# 			limit = {
# 				NOT = {
# 					has_spy_network_in = {
# 						who = FROM
# 						value = 100
# 					}
# 				}
# 				NOT = { full_idea_group = spy_ideas }
# 			}
# 			custom_trigger_tooltip = {
# 				tooltip = REQUIRES_100_SPY_NETWORK_TT
# 				has_spy_network_in = {
# 					who = FROM
# 					value = 100
# 				}
# 			}
# 		}
# 		if = {
# 			limit = {
# 				NOT = {
# 					has_spy_network_in = {
# 						who = FROM
# 						value = 80
# 					}
# 				}
# 				full_idea_group = spy_ideas
# 			}
# 			custom_trigger_tooltip = {
# 				tooltip = REQUIRES_80_SPY_NETWORK_TT
# 				has_spy_network_in = {
# 					who = FROM
# 					value = 24
# 				}
# 			}
# 		}
# 		if = {
# 			limit = {
# 				has_country_flag = assassination_ruler_counter_flag
# 				NOT = {
# 					had_country_flag = {
# 						flag = assassination_ruler_counter_flag
# 						days = 7300
# 					}
# 				}
# 			}
# 			custom_trigger_tooltip = {
# 				tooltip = ROOT_HAD_A_RECENT_ASSASSINATION
# 				NOT = {
# 					had_country_flag = {
# 						flag = assassination_ruler_counter_flag
# 						days = 7300
# 					}
# 				}
# 			}
# 		}
# 		if = {
# 			limit = {
# 				FROM = { has_ruler_flag = assassination_protection_flag }
# 			}
# 			custom_trigger_tooltip = {
# 				tooltip = FROM_CANT_BE_ASSASSINATED
# 				FROM = {
# 					has_ruler_flag = assassination_protection_flag
# 				}
# 			}
# 		}
# 	}
# 	on_accept = {
# 		clr_country_flag = assassination_ruler_counter_flag
# 		set_country_flag = assassination_ruler_counter_flag
# 		FROM = { kill_ruler = yes }
# 		if = {
# 			limit = {
# 				full_idea_group = spy_ideas
# 			}
# 			add_spy_network_in = {
# 				who = FROM
# 				value = -80
# 			}
# 		}
# 		else = {
# 			add_spy_network_in = {
# 				who = FROM
# 				value = -100
# 			}
# 		}
# 	}
# 	on_decline = {
# 	}

# 	ai_will_do = { # this is a trigger
# 		OR = {
# 			is_rival = FROM
# 			is_enemy = FROM
# 		}
# 		has_spy_network_in = {
# 			who = FROM
# 			value = 100
# 		}
# 	}
# }

#Associates
offer_canton = {
	category = influence
	require_acceptance = yes

	alert_index = 87
	alert_tooltip = offer_canton_alert_tooltip

	is_visible = {
		OR = {
			has_reform = canton_government
			has_reform = united_cantons_reform
		}
		is_subject = no
		FROM = {
			is_subject = no
		}
	}
	is_allowed = {
		if = {
			limit = {
				NOT = {
					FROM = {
						capital_scope = {
							superregion = switzerland_superregion
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_REQUIRES_CAPITAL_IN_SWITZERLAND_TT
				FROM = {
					capital_scope = {
						superregion = switzerland_superregion
					}
				}
			}
		}
		if = {
			limit = {
				FROM = { is_at_war = yes }
			}
			custom_trigger_tooltip = {
				tooltip = FROM_IS_AT_WAR_TT
				FROM = { is_at_war = no }
			}
		}
		if = {
			limit = {
				is_at_war = yes
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_IS_AT_WAR_TT
				is_at_war = no
			}
		}
		if = {
			limit = {
				FROM = {
					has_not_locked_first_tier_reform = no
				}
			}
			custom_trigger_tooltip = {
				tooltip = FROM_WRONG_GOVERNMENT_REFORM_TT
				FROM = {
					has_not_locked_first_tier_reform = yes
				}
			}
		}
	}
	on_accept = {
		create_subject = {
			subject_type = canton
			subject = FROM
		}
		FROM = {
			if = {
				limit = {
					NOT = { government = republic }
				}
				change_government = republic
				country_event = { id = 700 }
			}
			add_government_reform = canton_government
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
			FROM = {
				any_neighbor_country = {
					NOT = { tag = ROOT }
					FROM = {
						ai_attitude = {
							who = PREV
							attitude = attitude_threatened
						}
					}
				}
			}
			FROM = {
				ai_attitude = {
					who = ROOT
					attitude = attitude_threatened
				}
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		has_opinion = {
			who = FROM
			value = 50
		}
		NOT = {
			FROM = {
				has_country_modifier = cancel_partial_principality_timer
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = BASE_REJECTION
			limit = {
				always = yes
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -25
			}
		}
        add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = THEIR_GOVERNMENT_TYPE
			limit = { FROM = { government = republic } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = DIPLO_MSG_FILTER_NEIGHBOURS
			limit = { FROM = { is_neighbor_of = ROOT } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 5 }
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
			name = AI_TOTAL_DEVELOPMENT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = FROM
			}
			#4 dev = -1
			multiply_variable = {
				which = ai_value
				value = -0.25
			}
		}
		add_entry = {
			name = DIPLO_HAS_AI_HAS_OWN_SUBJECTS_TT
			limit = {
				FROM = { num_of_subjects = 1 }
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = attitude_neutral_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_neutral } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -20 }
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 10 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = DIPLO_BORDER_DISTANCE_TT
			export_to_variable = {
				variable_name = ai_value
				value = border_distance
				who = FROM
				with = ROOT
			}
			#2 units = -1
			multiply_variable = {
				which = ai_value
				value = -0.2
			}
		}
	}
}

cancel_canton = {
	category = influence
	require_acceptance = no

	is_visible = {
		OR = {
			AND = {
				is_subject_of = FROM
				is_subject_of_type = canton
			}
			FROM = {
				is_subject_of = ROOT
				is_subject_of_type = canton
			}
		}
	}
	is_allowed = {
	}
	on_accept = {
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = canton
			}
			grant_independence = yes		
		}
		else = {
			FROM = {
				grant_independence = yes
			}
		}
		if = {
			limit = {
				is_subject_of = FROM
				is_subject_of_type = canton
				NOT = { liberty_desire = 100 }
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_stability = -1
			}
			add_country_modifier = {
				name = cancel_canton_timer
				duration = 3650
				hidden = yes
			}
		}
		else_if = {
			limit = {
				FROM = {
					NOT = { liberty_desire = 100 }
				}
			}
			if = {
				limit = {
					has_stab_reduction_from_dip_action_modifier = yes
				}
				add_prestige = -1
			}
			else = {
				add_stability = -1
			}
			FROM = {
				add_country_modifier = {
					name = cancel_canton_timer
					duration = 3650
					hidden = yes
				}
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # Overlords will never want to break the relationship
		is_subject_of = FROM
		OR = {
			liberty_desire = 100
			AND = {
				stability = 1
				liberty_desire = 90
				NOT = {
					has_opinion = {
						who = ROOT
						value = -50
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 80
				NOT = {
					has_opinion = {
						who = ROOT
						value = -100
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 70
				NOT = {
					has_opinion = {
						who = ROOT
						value = -150
					}
				}
			}
			AND = {
				stability = 1
				liberty_desire = 60
				NOT = {
					has_opinion = {
						who = ROOT
						value = -199
					}
				}
			}
		}
		NOT = {
			any_neighbor_country = {
				ROOT = {
					ai_attitude = {
						who = PREV
						attitude = attitude_threatened
					}
				}
			}
		}
	}
}

#Switzerland
offer_reislaufer = {
	category = relation

	alert_index = 89
	alert_tooltip = offer_reislaufer_alert_tooltip

	require_acceptance = yes

	is_visible = {
		has_government_attribute = enables_offer_reislaufer
		FROM = {
			NOT = { has_government_attribute = enables_offer_reislaufer }
			is_subject = no
		}
	}
	is_allowed = {
		if = {
			limit = { war_with = FROM }
			custom_trigger_tooltip = {
				tooltip = WAR_WITH_FROM_TT
				NOT = { war_with = FROM }
			}
		}
		if = {
			limit = {
				ROOT = {
					has_country_flag = offer_reislaufer_cooldown
					NOT = {
						had_country_flag = {
							flag = offer_reislaufer_cooldown
							days = 3650
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_10_YEAR_CD_TT
				ROOT = {
					had_country_flag = {
						flag = offer_reislaufer_cooldown
						days = 3650
					}
				}
			}
		}
	}
	on_accept = {
		clr_country_flag = offer_reislaufer_cooldown
		set_country_flag = offer_reislaufer_cooldown

		FROM = {
			add_army_tradition = -10
		}
		add_army_tradition = 10

		hidden_effect = {
			FROM = {
				country_event = {
					id = canton_events.7
				}
			}
		}

		if = {
			limit = {
				army_tradition = 100
			}
			FROM = {
				create_general = { tradition = 100 culture = ROOT }
				add_manpower = 2.5
			}
		}
		else_if = {
			limit = {
				army_tradition = 90
			}
			FROM = {
				create_general = { tradition = 90 culture = ROOT }
				add_manpower = 2.25
			}
		}
		else_if = {
			limit = {
				army_tradition = 80
			}
			FROM = {
				create_general = { tradition = 80 culture = ROOT }
				add_manpower = 2
			}
		}
		else_if = {
			limit = {
				army_tradition = 70
			}
			FROM = {
				create_general = { tradition = 70 culture = ROOT }
				add_manpower = 1.75
			}
		}
		else_if = {
			limit = {
				army_tradition = 60
			}
			FROM = {
				create_general = { tradition = 60 culture = ROOT }
				add_manpower = 1.5
			}
		}
		else_if = {
			limit = {
				army_tradition = 50
			}
			FROM = {
				create_general = { tradition = 50 culture = ROOT }
				add_manpower = 1.25
			}
		}
		else_if = {
			limit = {
				army_tradition = 40
			}
			FROM = {
				create_general = { tradition = 40 culture = ROOT }
				add_manpower = 1
			}
		}
		else_if = {
			limit = {
				army_tradition = 30
			}
			FROM = {
				create_general = { tradition = 30 culture = ROOT }
				add_manpower = 0.75
			}
		}
		else_if = {
			limit = {
				army_tradition = 20
			}
			FROM = {
				create_general = { tradition = 20 culture = ROOT }
				add_manpower = 0.5
			}
		}
		else_if = {
			limit = {
				army_tradition = 10
			}
			FROM = {
				create_general = { tradition = 10 culture = ROOT }
				add_manpower = 0.25
			}
		}
		else = {
			FROM = {
				create_general = { tradition = 0 culture = ROOT }
			}
		}
	}
	on_decline = {
	}

	ai_will_do = { # this is a trigger
		OR = {
			ai_attitude = {
				who = FROM
				attitude = attitude_friendly
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_defensive
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_protective
			}
			ai_attitude = {
				who = FROM
				attitude = attitude_allied
			}
			is_subject_of = FROM
		}
		FROM = {
			years_of_income = 1
			is_in_deficit = no
			is_bankrupt = no
			NOT = { num_of_loans = 1 }
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_rivalry
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_threatened
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_hostile
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_outraged
			}
		}
		NOT = {
			ai_attitude = {
				who = FROM
				attitude = attitude_domineering
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = BASE_REJECTION
			limit = {
				always = yes
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -25
			}
		}
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
			name = HAS_DEFICIT
			limit = {
				FROM = {
					is_in_deficit = yes
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -25
			}
		}
		add_entry = {
			name = HAS_BANKRUPTCY
			limit = {
				FROM = {
					is_bankrupt = yes
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
		add_entry = {
			name = SIZE_OF_LOANS
			limit = {
				FROM = {
					num_of_loans = 1
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:num_of_loans
				who = FROM
			}
			multiply_variable = {
				which = ai_value
				value = -20
			}
		}
		add_entry = {
			name = CANNOT_AFFORD
			limit = {
				FROM = {
					NOT = { years_of_income = 1 }
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -1000
			}
		}
	}
}

#Ireland
ask_for_high_king_intervention = {
	category = relation

	alert_index = 95
	alert_tooltip = ask_for_high_king_intervention_alert_tooltip

	require_acceptance = yes

	is_visible = {
		has_government_attribute = enables_high_king_intervention
		FROM = {
			has_country_modifier = irish_high_king
			is_subject = no
		}
		NOT = { has_country_modifier = irish_high_king }
		is_subject = no
	}
	is_allowed = {
		if = {
			limit = { war_with = FROM }
			custom_trigger_tooltip = {
				tooltip = WAR_WITH_FROM_TT
				NOT = { war_with = FROM }
			}
		}
		if = {
			limit = {
				ROOT = {
					has_country_flag = had_high_king_aid
					NOT = {
						had_country_flag = {
							flag = had_high_king_aid
							days = 7300
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_20_YEAR_CD_TT
				ROOT = {
					had_country_flag = {
						flag = had_high_king_aid
						days = 7300
					}
				}
			}
		}
		if = {
			limit = {
				NOT = {
					any_war_enemy_country = {
						has_reform = tribal_kingdom
						is_in_war = {
							attacker_leader = THIS
							defender_leader = ROOT
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_NO_WAR_AGAINST_CLAN
				any_war_enemy_country = {
					has_reform = tribal_kingdom
					is_in_war = {
						attacker_leader = THIS
						defender_leader = ROOT
					}
				}
			}
		}
		if = {
			limit = {
				any_war_enemy_country = {
					has_reform = tribal_kingdom
					is_in_war = {
						attacker_leader = THIS
						defender_leader = ROOT
					}
				}
				NOT = {
					any_war_enemy_country = {
						has_reform = tribal_kingdom
						is_in_war = {
							attacker_leader = THIS
							defender_leader = ROOT
							war_score = 50
						}
					}
				}
			}
			custom_trigger_tooltip = {
				tooltip = ROOT_WAR_SCORE_UNDER_50
				any_war_enemy_country = {
					has_reform = tribal_kingdom
					is_in_war = {
						attacker_leader = THIS
						defender_leader = ROOT
						war_score = 50
					}
				}
			}
		}
	}
	on_accept = {
		clr_country_flag = had_high_king_aid
		set_country_flag = had_high_king_aid

		FROM = { add_prestige = 5 }

		every_war_enemy_country = {
			limit = {
				has_reform = tribal_kingdom
				is_in_war = {
					attacker_leader = THIS
					defender_leader = ROOT
				}
			}
			white_peace = ROOT
			add_truce_with = ROOT
			ROOT = { add_truce_with = PREV }

			country_event = {
				id = vn_ire_kingdom.8
			}
		}
	}
	on_decline = {
		FROM = {
			add_prestige = -5
		}
	}

	ai_will_do = { # this is a trigger
		OR = {
			war_exhaustion = 10
			AND = {
				ruler_has_personality = craven_personality
				war_exhaustion = 5
			}
		}
		OR = {
			any_war_enemy_country = {
				has_reform = tribal_kingdom
				NOT = { has_country_modifier = irish_high_king }
				is_in_war = {
					attacker_leader = THIS
					defender_leader = ROOT
					war_score = 75
				}
			}
			AND = {
				ruler_has_personality = craven_personality
				any_war_enemy_country = {
					has_reform = tribal_kingdom
					NOT = { has_country_modifier = irish_high_king }
					is_in_war = {
						attacker_leader = THIS
						defender_leader = ROOT
						war_score = 55
					}
				}
			}
		}
	}

	ai_acceptance = {
		add_entry = {
			name = BASE_REJECTION
			limit = {
				always = yes
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			multiply_variable = {
				which = ai_value
				value = -25
			}
		}
		add_entry = {
			name = AI_TRUST_TOWARDS_ROOT
			export_to_variable = {
				variable_name = ai_value
				value = trust
				who = FROM
				with = ROOT
			}			
			subtract_variable = { 
				which = ai_value
				value = 50
			}
			#1 trust = +4 ai points
			multiply_variable = {
				which = ai_value
				value = 0.4
			}
		}
		add_entry = {
			name = AI_DIPLOMATIC_REPUTATION
			export_to_variable = {
				variable_name = ai_value
				value = trigger_value:diplomatic_reputation
			}
			#1 rep = 3
			multiply_variable = {
				which = ai_value
				value = 3
			}
		}
		add_entry = {
            name = DIPLO_OPPINION
			export_to_variable = {
				variable_name = ai_value
				value = opinion
				who = FROM
				with = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 0.125
			}
        }
		add_entry = {
            name = war_exhaustion
			export_to_variable = {
				variable_name = ai_value
				value = war_exhaustion
				who = ROOT
			}
			multiply_variable = {
				which = ai_value 
				value = 1.25
			}
        }
		add_entry = {
			name = DIPLO_OUR_TOTAL_DEVELOPMENT_TT
			export_to_variable = {
				variable_name = ai_value
				value = total_development
				who = ROOT
			}
			multiply_variable = {
				which = ai_value
				value = -0.2
			}
		}
		add_entry = {
			name = AI_PERSONALITY
			limit = {
				FROM = {
					OR = {
						personality = ai_diplomat
						personality = ai_colonialist
					}
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = 10
			}
		}
		add_entry = {
			name = AI_PERSONALITY
			limit = {
				FROM = {
					personality = ai_militarist
				}
			}
			export_to_variable = {
				variable_name = ai_value
				value = 1
			}
			
			multiply_variable = {
				which = ai_value
				value = -20
			}
		}
		add_entry = {
			name = attitude_rivalry_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_rivalry } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_hostile_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_hostile } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_friendly_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_friendly } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_threatened_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_threatened } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = 20 }
		}
		add_entry = {
			name = attitude_outraged_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_outraged } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
		add_entry = {
			name = attitude_domineering_DIPLO_ATTITUDE_TT
			limit = { FROM = { ai_attitude = { who = ROOT attitude = attitude_domineering } } }
			export_to_variable = { variable_name = ai_value value = 1 }
			multiply_variable = { which = ai_value value = -1000 }
		}
	}
}